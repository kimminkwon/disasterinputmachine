<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout1}">

<div layout:fragment="content">
    <div class="panel panel-primary">
        <div class="panel-heading">List of Maintenance</div>
    </div>
    <div class="panel-body pull-left" style="float: left;">
        <h4 style="float: left; margin-right: 10px;"><a class="label label-warning" th:href="@{../reservation/list}">RESERVATION LIST</a></h4>
        <h4 style="float: right;"><a class="label label-danger" th:href="@{../delete/list}">DELETE LIST</a></h4>
    </div>

    <div class="panel-body pull-right" style="float: right;">
        <h4><a class="label label-default" th:href="@{register}">RESISTER</a></h4>
    </div> <div style="clear:both;"></div>

    <div class="panel-body">

        <div th:with="listOfDto=${listOfDto.result}">
            <!-- Table -->
            <table class="table table-striped table-bordered table-hover"
                   id="dataTables-example">
                <thead>
                <tr>
                    <th>분류번호</th>
                    <th>대분류</th>
                    <th>중분류</th>
                    <th>소분류</th>
                    <th>연도(묘호년)</th>
                    <th>연도(서기)</th>
                    <th>월</th>
                    <th>국가(한국)</th>
                    <th>왕조(한국)</th>
                    <th>지역1</th>
                    <th>지역2</th>
                    <th>지역3</th>
                </tr>
                </thead>
                <tbody>
                <tr class="odd gradeX" th:each="boardDto:${listOfDto.content}">
                    <td>
                        <a th:href='${boardDto.mno}' class='boardLink'>[[${boardDto.mno}]]</a>
                    </td>
                    <td> [[${boardDto.lclasKR}]] </td>
                    <td> [[${boardDto.mclasKR}]] </td>
                    <td> [[${boardDto.sclasKR}]] </td>
                    <td> [[${boardDto.yearNameOfTomb}]] </td>
                    <td> [[${boardDto.yearAD}]] </td>
                    <td> [[${boardDto.month}]] </td>
                    <td> [[${boardDto.nationKR}]] </td>
                    <td> [[${boardDto.dynastyKR}]] </td>
                    <td> [[${boardDto.area1KR}]] </td>
                    <td> [[${boardDto.area2KR}]] </td>
                    <td> [[${boardDto.area3KR}]] </td>
                </tr>
                </tbody>
            </table>

            <!-- Search Space -->
            <div>
                <input type='text' id='searchType' th:value="${pageVO.type}" placeholder="type1, type2, ...">
                <input type='text' id='searchKeyword' th:value="${pageVO.keyword}" placeholder="keyword1, keyword2, ...">
                <button id='searchBtn'>Search</button>

                <button id='detailSearchBtn' class="pull-right">Detail Search</button>
            </div>


            <!-- Paging size -->
            <div>
                <input type="number" id="pageSize" min="10" max="50" step="5" placeholder="size" required >
                <button id='pageBtn'>Submit</button>
            </div>

        </div>

        <!-- Paging -->
        <nav>
            <div>
                <ul class="pagination">
                    <li class="page-item" th:if="${listOfDto.prevPage}">
                        <a th:href="${listOfDto.prevPage.pageNumber} + 1">
                            PREV [[${listOfDto.prevPage.pageNumber} + 1]]
                        </a>
                    </li>
                    <li class="page-item"
                        th:classappend="${p.pageNumber == listOfDto.currentPageNum - 1}? active : ''"
                        th:each="p:${listOfDto.pageList}">
                        <a th:href="${p.pageNumber} + 1">
                            [[${p.pageNumber} + 1]]
                        </a>
                    </li>
                    <li class="page-item" th:if="${listOfDto.nextPage}">
                        <a th:href="${listOfDto.nextPage.pageNumber} + 1">
                            NEXT [[${listOfDto.nextPage.pageNumber} + 1]]
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Form for Data passing -->
        <form id='f1' th:action="@{list}" method="get">
            <input type='hidden' name='page' th:value=${listOfDto.currentPageNum}>
            <input type='hidden' name='size' th:value=${listOfDto.currentPage.pageSize}>
            <input type='hidden' name='type' th:value=${pageVO.type}>
            <input type='hidden' name='keyword' th:value=${pageVO.keyword}>
        </form>
    </div>
    <!-- end panel -->
    
</div>
<!-- end fragment -->

<th:block layout:fragment="script">
    <script th:inline="javascript">

        $(document).ready(function () {
            var formObj = $("#f1");

            // Paging 버튼이 클릭되었을 때 (pagination = Page 관련 ui)
            $(".pagination a").click(function(e) {
                e.preventDefault();
                formObj.find('[name="page"]').val($(this).attr('href'));
                formObj.submit();
            });

            // Search 버튼이 클릭되었을 때
            $("#searchBtn").click(function(e) {
                // var typeStr = $("#searchType").find(":selected").val();
                var typeStr = $("#searchType").val();
                var keywordStr = $("#searchKeyword").val();
                console.log(typeStr, "", keywordStr);

                formObj.find("[name='type']").val(typeStr);
                formObj.find("[name='keyword']").val(keywordStr);
                formObj.find("[name='page']").val("1");
                formObj.submit();
            });

            // pageSize 버튼이 클릭되었을 때
            $("#pageBtn").click(function(e) {
                var pageSizeStr = $("#pageSize").val();
                console.log("", pageSizeStr);

                formObj.find("[name='size']").val(pageSizeStr);
                formObj.submit();
            });

            // 저장이 된 후에 이쪽 페이지로 넘어왔을 때 저장 완료 메세지
            $(window).load(function (){
                var msg = [[${msg}]];

                if(msg == 'success') {
                    alert("정상적으로 처리되었습니다.");
                    var stateObj = { msg:"" };
                }
            });

            // bno를 클릭했을 시, 수정 페이지로 넘어가도록 하는 메서드
            $(".boardLink").click(function (e){
                e.preventDefault();
                var boardNo = $(this).attr("href");
                formObj.attr("action", [[@{'/maintenance/view'}]]);
                formObj.append("<input type='hidden' name='mno' value='" + boardNo + "'>");
                formObj.submit();
            });

            // detailSearchBtn을 클릭했을 시, 검색 페이지로 넘어가도록 하는 메서드
            $("#detailSearchBtn").click(function (e){
                e.preventDefault();
                formObj.attr("action", [[@{'/maintenance/search'}]]);
                formObj.submit();
            });
        });

    </script>
</th:block>